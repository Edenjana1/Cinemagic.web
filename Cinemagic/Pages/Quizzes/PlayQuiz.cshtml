@page
@model Cinemagic.Pages.Quizzes.PlayQuizModel
@{
    ViewData["Title"] = "Play Quiz";
}

<div class="container mt-4" style="max-width: 600px;">
    <h2 class="mb-3 text-primary">@Model.Quiz.Title</h2>

    <h5>Question @(@Model.QuestionIndex + 1) of @Model.Quiz.Questions.Count</h5>

    <p class="mt-3 fw-semibold">@Model.CurrentQuestion.QuestionText</p>

    <form method="post">
        <div class="list-group">
            @for (int i = 0; i < Model.CurrentQuestion.Options.Count; i++)
            {
                var optionText = Model.CurrentQuestion.Options[i];
                var bgClass = "";

                if (Model.IsAnswerCorrect.HasValue)
                {
                    if (Model.SelectedOptionIndex == i)
                    {
                        bgClass = Model.IsAnswerCorrect.Value ? "list-group-item-success" : "list-group-item-danger";
                    }
                    else if (i == Model.CurrentQuestion.CorrectOptionIndex)
                    {
                        bgClass = "list-group-item-success";
                    }
                }

                <label class="list-group-item @bgClass">
                    <input type="radio" name="SelectedOptionIndex" value="@i"
                    @(Model.SelectedOptionIndex == i ? "checked" : "")
                    @(Model.IsAnswerCorrect.HasValue ? "disabled" : "") />
                    @optionText
                </label>
            }
        </div>

        <input type="hidden" name="QuizId" value="@Model.QuizId" />
        <input type="hidden" name="QuestionIndex" value="@Model.QuestionIndex" />

        <div class="mt-4">
            @if (!Model.IsAnswerCorrect.HasValue)
            {
                <button type="submit" class="btn btn-primary">Check Answer</button>
            }
            else
            {
                @if (Model.IsLastQuestion)
                {
                    <div class="alert alert-success mt-4">
                        <h5>Well done!</h5>
                        <p>You answered correctly <strong>@Model.CorrectAnswersCount</strong> out of <strong>@Model.Quiz.Questions.Count</strong> questions.</p>
                        <a class="btn btn-primary mt-2" asp-page="./Index">Back to All Quizzes</a>
                    </div>
                }
                else
                {
                    <a class="btn btn-success" asp-page="./PlayQuiz" asp-route-QuizId="@Model.QuizId" asp-route-QuestionIndex="@(Model.QuestionIndex + 1)">Next Question</a>

                    <a class="btn btn-secondary ms-2" asp-page="./Index">Exit Quiz</a>
                }
            }
        </div>
    </form>
</div>
