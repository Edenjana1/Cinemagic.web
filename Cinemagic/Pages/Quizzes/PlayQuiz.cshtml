@page 
@model Cinemagic.Pages.Quizzes.PlayQuizModel
@{
    ViewData["Title"] = "Play Quiz";
}


<div class="container mt-4" style="max-width: 600px;">
    <h2>@Model.Quiz.Title</h2>

    <h4>Question @(@Model.QuestionIndex + 1) / @Model.Quiz.Questions.Count</h4>

    <p class="mt-3">@Model.CurrentQuestion.QuestionText</p>

    <form method="post">
        <div class="list-group">
            @for (int i = 0; i < Model.CurrentQuestion.Options.Count; i++)
            {
                var optionText = Model.CurrentQuestion.Options[i];
                var bgClass = "";

                if (Model.IsAnswerCorrect.HasValue)
                {
                    if (Model.SelectedOptionIndex == i)
                    {
                        bgClass = Model.IsAnswerCorrect.Value ? "list-group-item-success" : "list-group-item-danger";
                    }
                    else if (i == Model.CurrentQuestion.CorrectOptionIndex)
                    {
                        bgClass = "list-group-item-success";
                    }
                }

                <label class="list-group-item @bgClass">
                    <input type="radio" name="SelectedOptionIndex" value="@i" @(Model.SelectedOptionIndex == i ? "checked" : "")
                    @(Model.IsAnswerCorrect.HasValue ? "disabled" : "") />
                    @optionText
                </label>
            }
        </div>

        <input type="hidden" name="QuizId" value="@Model.QuizId" />
        <input type="hidden" name="QuestionIndex" value="@Model.QuestionIndex" />

        <div class="mt-3">
            @if (!Model.IsAnswerCorrect.HasValue)
            {
                <button type="submit" class="btn btn-primary">Check Answer</button>
            }
            else
            {
                @if (Model.IsAnswerCorrect.HasValue && Model.IsLastQuestion)
                {
                    <div class="alert alert-info mt-4">
                        Quiz finished! Your score: @Model.CorrectAnswersCount / @Model.Quiz.Questions.Count
                    </div>

                    <a class="btn btn-primary" asp-page="./Index">Back to Quizzes</a>
                }
                else
                {
                    <a class="btn btn-primary" asp-page="./Index">Finish Quiz</a>
                }
            }
           
        </div>
    </form>
</div>
